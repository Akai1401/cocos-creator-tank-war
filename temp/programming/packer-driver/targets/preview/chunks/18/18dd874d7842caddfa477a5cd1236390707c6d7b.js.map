{"version":3,"sources":["file:///Users/akai/Data/cocos/TankWar/assets/script/roomCtrl.ts"],"names":["_decorator","Button","Component","director","instantiate","Label","Node","Prefab","Vec3","ccclass","property","roomCtrl","type","onLoad","renderUserList","playBtn","node","on","EventType","CLICK","window","socketManager","send","JSON","stringify","event","data","id","myTankId","onmessage","parse","loadScene","console","log","removeUserFromList","tank","addUserToList","userListContainer","removeAllChildren","userListArr","push","newArr","filter","item","forEach","userNode","labelNode","labelComponent","addComponent","string","slice","setPosition","addChild","name","userCount","children","length","row","Math","floor","col","xOffset","yOffset","newPosition"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Button,\n  Component,\n  director,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  Vec3,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"roomCtrl\")\nexport class roomCtrl extends Component {\n  // play button\n  @property({ type: Button })\n  playBtn: Button = null;\n\n  // tank prefab\n  @property({ type: Prefab })\n  public tank: Prefab = null;\n\n  // user list container\n  @property({ type: Node })\n  public userListContainer: Node = null;\n\n  onLoad() {\n    // render my tank\n    this.renderUserList();\n\n    // on click play button\n    this.playBtn.node.on(Button.EventType.CLICK, () => {\n      (window as any).socketManager.send(\n        JSON.stringify({\n          event: \"startGame\",\n          data: {\n            id: (window as any).myTankId,\n          },\n        })\n      );\n    });\n\n    // socket listeners\n    (window as any).socketManager.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      // on startGame event\n      if (data?.event === \"startGame\") {\n        director.loadScene(\"play\");\n        return;\n      }\n      // on leave room event\n      if (data?.event === \"disconnect\") {\n        console.log(\"disconnect\", data);\n        this.removeUserFromList(data);\n      }\n      // on joinRoom event\n      if (data?.event === \"joinRoom\") {\n        this.tank && this.addUserToList(data);\n      }\n    };\n  }\n\n  addUserToList(data: any) {\n    this.userListContainer.removeAllChildren();\n    (window as any).userListArr.push(data);\n    this.renderUserList();\n  }\n\n  removeUserFromList(data: any) {\n    this.userListContainer.removeAllChildren();\n    const newArr = (window as any).userListArr.filter(\n      (item: any) => item.id !== data?.id\n    );\n    (window as any).userListArr = newArr;\n    this.renderUserList();\n  }\n\n  renderUserList() {\n    (window as any).userListArr.forEach((item: any) => {\n      const userNode = instantiate(this.tank);\n      const labelNode = new Node();\n      const labelComponent = labelNode.addComponent(Label);\n      labelComponent.string =\n        item?.id?.slice(0, 3) +\n        (item?.id === (window as any).myTankId ? \" (You)\" : \"\");\n      labelNode.setPosition(new Vec3(0, 70, 0));\n      userNode.addChild(labelNode);\n      userNode.name = item?.id;\n\n      const userCount = this.userListContainer.children.length;\n      const row = Math.floor(userCount / 4);\n      const col = userCount % 4;\n      const xOffset = 150;\n      const yOffset = 150;\n      const newPosition = new Vec3(\n        -220 + col * xOffset,\n        100 + -row * yOffset,\n        0\n      );\n      userNode.setPosition(newPosition);\n      this.userListContainer.addChild(userNode);\n    });\n  }\n}\n"]}