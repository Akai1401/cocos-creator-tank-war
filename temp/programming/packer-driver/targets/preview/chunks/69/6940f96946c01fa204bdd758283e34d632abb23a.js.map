{"version":3,"sources":["file:///Users/akai/Data/cocos/cocos-creator-tank-war/assets/script/Store.ts"],"names":["_decorator","AudioSource","Button","Component","director","instantiate","Label","Node","Prefab","Sprite","Vec3","buyItem","getAllItems","getMyItem","colorMapping","ccclass","property","Store","type","handleBuyItem","itemId","res","console","log","onLoad","then","itemPrefab","forEach","item","userNode","starPriceNode","getChildByName","getComponent","string","startPrice","addComponent","on","EventType","CLICK","window","Telegram","WebApp","close","id","strkPriceNode","starknetPrice","color","userCount","itemListContainer","children","length","row","Math","floor","col","xOffset","yOffset","newPosition","setPosition","addChild","activeItemPrefab","node","backBtn","loadScene","audioSource","play","start"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  AudioClip,\n  AudioSource,\n  Button,\n  Color,\n  Component,\n  director,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  Sprite,\n  Vec3,\n} from \"cc\";\nimport { buyItem, getAllItems, getMyItem } from \"./apis\";\nimport { colorMapping } from \"./utils\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"Store\")\nexport class Store extends Component {\n  @property({ type: Button })\n  backBtn: Button = null;\n\n  @property(Prefab)\n  activeItemPrefab: Prefab;\n\n  @property(Prefab)\n  itemPrefab: Prefab;\n\n  @property({ type: Node })\n  public itemListContainer: Node = null;\n\n  @property({\n    type: [AudioSource],\n  })\n  public audioSource: AudioSource = null!;\n\n  async handleBuyItem(itemId: string) {\n    const res = await buyItem(itemId);\n    console.log(res);\n  }\n\n  onLoad() {\n    getAllItems().then((res) => {\n      if (this.itemPrefab) {\n        res.forEach((item: any) => {\n          const userNode = instantiate(this.itemPrefab);\n          const starPriceNode = userNode.getChildByName(\"star-price\");\n          starPriceNode.getComponent(Label).string = item.startPrice + \" Star\";\n          starPriceNode.addComponent(Button);\n\n          starPriceNode.on(Button.EventType.CLICK, () => {\n            // console.log(\"buy item by star\", item);\n            (window as any).Telegram.WebApp &&\n              (window as any).Telegram.WebApp.close();\n            this.handleBuyItem(item.id);\n          });\n          const strkPriceNode = userNode.getChildByName(\"strk-price\");\n          strkPriceNode.getComponent(Label).string =\n            item.starknetPrice + \" STRK\";\n          strkPriceNode.addComponent(Button);\n\n          strkPriceNode.on(Button.EventType.CLICK, () => {\n            console.log(\"buy item by STRK\", item);\n          });\n\n          if (colorMapping[item.color]) {\n            userNode.getChildByName(\"image\").getComponent(Sprite).color =\n              colorMapping[item.color];\n          }\n\n          const userCount = this?.itemListContainer?.children?.length || 0;\n          const row = Math.floor(userCount / 2);\n          const col = userCount % 2;\n          const xOffset = 300;\n          const yOffset = 200;\n          const newPosition = new Vec3(\n            -150 + col * xOffset,\n            150 + -row * yOffset,\n            0\n          );\n          userNode.setPosition(newPosition);\n          this.itemListContainer.addChild(userNode);\n        });\n      }\n    });\n\n    getMyItem().then((res) => {\n      if (this.activeItemPrefab) {\n        const userNode = instantiate(this.activeItemPrefab);\n        if (colorMapping[res.color]) {\n          userNode.getChildByName(\"image\").getComponent(Sprite).color =\n            colorMapping[res.color];\n        }\n        this.node.addChild(userNode);\n      }\n    });\n\n    this.backBtn.node.on(Button.EventType.CLICK, () => {\n      director.loadScene(\"menu\");\n    });\n    this.audioSource.play();\n  }\n\n  start() {\n    console.log(\"starttt\");\n  }\n}\n"]}